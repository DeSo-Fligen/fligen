# fligen 需求文稿

fligen 是一个去中心化社交应用

## 账号系统

账号由 地址，公钥，私钥组成。
用户不需要注册，在本地生成。账号数据不保存在服务器。
私钥加密后得到公钥，公钥 hash 之后得到地址。

使用了开源库：Eth-crypto

## 去中心化策略

去中心化的策略暂时定位在以太坊上公链的建立智能合约。

智能合约存储公开动态（成本貌似比较昂贵？）
以及用于通知的信息。例如用类似 `mapping(address => Msg[])` 的结构

账号的助记词功能和导入也可以开发一下

## 撰写动态

用户可以发送文本到动态，核载数据包括但不限于以下信息：

- title： 动态标题
- description： 动态描述
- markdown：markdown 内容
- ...

## 发布动态

### 动态分类

#### 公开动态

该动态由发布者签名可验证。保存到智能合约内，并且所有人可以查看。

所有用户可以评论，博主可以选择删除某条评论，可以选择删除本条动态。

评论数据结构：

- publicKey：该用户公钥
- content: 评论内容
- time：评论的时间

#### 私密动态

使用公钥加密之后，形成一串密文，该密文可以保存到本地？由于经过了加密，所以用户隐私不会暴露。数据经过该授权可提供给他人查看。（可能需要支付一定的货币？）

##### 私密动态授权方案

用户B发送申请查看私密动态信息到用户A，并附带用户B的公钥。A同意之后使用该公钥加密之后发送给B，B用自己的私钥解密即可查看。

该操作为一次性，如果用户A发布新的私密动态，A如需查看，需要再次授权。

授权信息包括：
- publicKey： 自己的公钥
- from：查看的起始日期
- to：查看的结束日期 （from > to)
- count: 申请查看的动态数量 (>=目标用户私密动态数量数)

## 通知系统

通知信息保存在服务器数据库，当用户获取到自己的通知的时候，服务器将会删除该记录。

采用客户端轮询，例如一分钟检查一下是否有自己的新通知。

或 采用 tcp 长链接，尚不确定。

这一块有空还得研究一下

## 通讯系统

用户A向用户B发送内容过程：输入文本内容，使用B的公钥加密。保存到服务器。当用户B获取通知时，会从服务器获取，并且在本地使用自己的私钥解密，内容存入本地数据库。

这一块有空还得研究一下 * 2