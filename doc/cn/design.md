# fligen 需求文稿

fligen 是一个以加密算法为基础的 geek 社交应用（非区块链）

## 账号系统

账号由 地址，公钥，私钥组成。
用户不需要注册，在本地生成。账号数据不保存在服务器。
私钥加密后得到公钥，公钥 hash 之后得到地址。

使用了开源库：Eth-crypto

## 去中心化策略

由于目前不能实现真正的P2P网络，所以还是需要有服务器提供中转服务。

且区块链的数据同步需要消耗大量的客户端资源，对于一个非金融属性的软件，边际效益低，边际成本高，不太合适。所以暂时采用本地存储个人信息，以及服务器转发数据到客户端的形式。

未来服务器可部署多台，或者用户可以通过frp提供自己的本地服务。

如果有好的共识机制，工作量证明，公共动态也可用区块链的形式保存，但由于区块链的可溯源性，对于一些敏感数据可能造成不可逆的泄露。

## 撰写动态

用户可以发送文本到动态，核载数据包括但不限于以下信息：

- title： 动态标题
- description： 动态描述
- markdown：markdown 内容
- ...

## 发布动态

### 动态分类

#### 公开动态

该动态由发布者签名可验证。保存到服务器，并且所有人可以查看。

所有用户可以评论，博主可以选择删除某条评论，可以选择删除本条动态。

评论数据结构：

- publicKey：该用户公钥
- content: 评论内容
- time：评论的时间

#### 私密动态

使用公钥加密之后，形成一串密文，该密文可以保存到本地，也可以保存到服务器，由于经过了加密，所以用户隐私不会暴露。数据经过该授权可提供给他人查看。

##### 私密动态授权方案

用户B发送申请查看私密动态信息到用户A，并附带用户B的公钥。A同意之后使用该公钥加密之后发送给B，B用自己的私钥解密即可查看。

该操作为一次性，如果用户A发布新的私密动态，A如需查看，需要再次授权。

授权信息包括：
- publicKey： 自己的公钥
- from：查看的起始日期
- to：查看的结束日期 （from > to)
- count: 申请查看的动态数量 (>=目标用户私密动态数量数)

## 通知系统

通知信息保存在服务器数据库，当用户获取到自己的通知的时候，服务器将会删除该记录。

采用客户端轮询，例如一分钟检查一下是否有自己的新通知。

或 采用 tcp 长链接，尚不确定。

## 通讯系统

用户A向用户B发送内容过程：输入文本内容，使用B的公钥加密。保存到服务器。当用户B获取通知时，会从服务器获取，并且在本地使用自己的私钥解密，内容存入本地数据库。